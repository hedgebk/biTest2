package bthdg.ws;

import bthdg.exch.Exchange;
import bthdg.exch.Huobi;
import bthdg.exch.Pair;
import bthdg.exch.TradeData;
import bthdg.util.Utils;
import io.socket.IOAcknowledge;
import io.socket.IOCallback;
import io.socket.SocketIO;
import io.socket.SocketIOException;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.net.MalformedURLException;
import java.util.Arrays;
import java.util.List;
import java.util.Properties;

public class HuobiWs extends BaseWs {
    public static final String ADDRESS = "http://hq.huobi.com:80/";
    public static final int DEF_RECONNECT_DELAY = 5000;

    private SocketIO m_socket;
    private Thread m_reconnectThread;
    private ITradesListener m_historyTradesListener;

    public static void main(String[] args) {
        try {
            new HuobiWs().subscribe();

            Thread thread = Thread.currentThread();
            synchronized (thread) {
                thread.wait();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public void subscribe() {
        try {
            m_socket = new SocketIO(ADDRESS);
        } catch (MalformedURLException e) {}

        m_socket.connect(new IOCallback() {
            @Override public void onMessage(JSONObject json, IOAcknowledge ack) {
                try {
                    System.out.println("Server said:" + json.toString(2));
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }

            @Override public void onMessage(String data, IOAcknowledge ack) {
                System.out.println("Server said: " + data);
            }

            @Override public void onError(SocketIOException socketIOException) {
                System.out.println("onError() an Error occurred: " + socketIOException);
                socketIOException.printStackTrace();

                System.out.println("will retry again. isConnected=" + m_socket.isConnected() + "; m_reconnectThread=" + m_reconnectThread);
                if (m_reconnectThread != null && m_reconnectThread.isAlive() && !m_reconnectThread.isInterrupted()) {
                    synchronized (m_reconnectThread) {
                        System.out.println(" notify reconnect thread");
                        m_reconnectThread.notify();
                    }
                } else {
                    System.out.println(" starting reconnect thread");
                    m_reconnectThread = new Thread() {
                        @Override public void run() {
                            try {
                                long reconnectDelay = DEF_RECONNECT_DELAY;
                                int attempt = 1;
                                while (!isInterrupted()) {
                                    System.out.println("sleep " + reconnectDelay + " ms before reconnect attempt " + attempt);
                                    Thread.sleep(reconnectDelay);
                                    synchronized (m_reconnectThread) {
                                        System.out.println("reconnecting, attempt " + attempt + "...");

                                        subscribe();

                                        System.out.println("reconnect invoked, waiting");
                                        m_reconnectThread.wait();
                                        reconnectDelay = reconnectDelay * 3 / 2;
                                        attempt++;
                                    }
                                }
                                System.out.println("reconnect thread was interrupted - finishing after  " + (attempt - 1) + " attempts");
                            } catch (Exception e) {
                                System.out.println("error in reconnect thread: " + e);
                                e.printStackTrace();
                            }
                            m_reconnectThread = null;
                        }
                    };
                    m_reconnectThread.start();
                }
            }

            @Override public void onDisconnect() {
                System.out.println("Connection terminated. onDisconnect()");
            }

            @Override public void onConnect() {
                System.out.println("Connection established. onConnect() isConnected="+ m_socket.isConnected());
                if (m_reconnectThread != null && m_reconnectThread.isAlive() && !m_reconnectThread.isInterrupted()) {
                    synchronized (m_reconnectThread) {
                        System.out.println(" notify and interrupt reconnect thread");
                        m_reconnectThread.notify();
                        m_reconnectThread.interrupt();
                    }
                }
                sendSubscribe();
            }

            @Override public void on(String event, IOAcknowledge ack, Object... args) {
//                System.out.println("Server triggered event '" + event + "'; args=" + args);
                try {
                    if (event.equals("message")) {
                        List<Object> array = Arrays.asList(args);
//                        System.out.println(" array=" + array);
                        for (Object obj : array) {
//                            System.out.println("  obj=" + obj);
//                            System.out.println("   .class=" + obj.getClass());
                            JSONObject json = (JSONObject) obj;
                            String msgType = (String) json.get("msgType");
//                            System.out.println("   msgType=" + msgType);
                            if (msgType.equals("marketDetail")) {
                                parseMarketDetail(json);
                            } else if (msgType.equals("tradeDetail")) {
                                parseTradeDetail(json);
                            } else {
                                System.out.println("ERROR: not supported msgType=" + msgType);
                            }
                        }
                    }
                } catch (JSONException e) {
                    System.out.println("error parsing json: " + e);
                    e.printStackTrace();
                }
            }

            private void parseTradeDetail(JSONObject json) throws JSONException {
                JSONObject payload = (JSONObject) json.get("payload");
//                System.out.println("   payload=" + payload);
                {
                    JSONArray amount = (JSONArray) payload.get("amount");
//                        System.out.println("     amount=" + amount);
                    int length = amount.length();
//                        System.out.println("      .length=" + length);
                    JSONArray price = (JSONArray) payload.get("price");
//                        System.out.println("     price=" + price);
//                        System.out.println("      .length=" + price.length());
                    JSONArray time = (JSONArray) payload.get("time");
//                        System.out.println("     time=" + time);
//                        System.out.println("      .length=" + time.length());
                    JSONArray topAsks = (JSONArray) payload.get("topAsks");
//                        System.out.println("     topAsks=" + topAsks);
//                        System.out.println("      .length=" + topAsks.length());
                    JSONArray topBids = (JSONArray) payload.get("topBids");
//                        System.out.println("     topBids=" + topBids);
//                        System.out.println("      .length=" + topBids.length());
                    for (int i = 0; i < length; i++) {
                        Double amt = Utils.getDouble(amount.get(i));
                        Double prc = Utils.getDouble(price.get(i));
                        Integer tm = (Integer) time.get(i);
                        long timestamp = tm * 1000L;
//                        System.out.println("         date=" + new Date(timestamp));

                        JSONObject asks = (JSONObject) topAsks.get(i);
//                            System.out.println("       asks[" + i + "] asks=" + asks);
                        JSONArray askAmounts = (JSONArray) asks.get("amount");
//                            System.out.println("        amount=" + askAmounts);
                        int askAmountsNum = askAmounts.length();
//                            System.out.println("        .length=" + askAmountsNum);
                        JSONArray askPrices = (JSONArray) asks.get("price");
//                            System.out.println("        price=" + askPrices);
//                            System.out.println("        .length=" + askPrices.length());
//                            for (int j = 0; j < askAmountsNum; j++) {
//                                Double askAmt = Utils.getDouble(askAmounts.get(j));
//                                Double askPrc = Utils.getDouble(askPrices.get(j));
//                                System.out.println("         ask[" + j + "] amount=" + askAmt + "; price=" + askPrc);
//                            }
                        JSONObject bids = (JSONObject) topBids.get(i);
//                            System.out.println("       bids[" + i + "] bids=" + asks);
                        JSONArray bidAmounts = (JSONArray) bids.get("amount");
//                            System.out.println("        amount=" + bidAmounts);
                        int bidAmountsNum = bidAmounts.length();
//                            System.out.println("        .length=" + bidAmountsNum);
                        JSONArray bidPrices = (JSONArray) bids.get("price");
//                            System.out.println("        price=" + bidPrices);
//                            System.out.println("        .length=" + bidPrices.length());
//                            for (int j = 0; j < bidAmountsNum; j++) {
//                                Double bidAmt = Utils.getDouble(bidAmounts.get(j));
//                                Double bidPrc = Utils.getDouble(bidPrices.get(j));
//                                System.out.println("         bid[" + j + "] amount=" + bidAmt + "; price=" + bidPrc);
//                            }
                        Double askPrc = Utils.getDouble(askPrices.get(i < askAmountsNum ? i : 0));
                        Double bidPrc = Utils.getDouble(bidPrices.get(i < bidAmountsNum ? i : 0));

//                        System.out.println("       trade[" + i + "] timestamp=" + timestamp + "; amt=" + amt + "; prc=" + prc + "; tm=" + tm + ";   BID=" + bidPrc + "; ASK=" + askPrc);

                        if (m_tradesListener != null) {
                            m_tradesListener.onTrade(new TradeData(amt, prc, timestamp));
                        }
                        if (m_topListener != null) {
                            m_topListener.onTop(timestamp, bidPrc, askPrc);
                        }
                    }
                }
            }

            private void parseMarketDetail(JSONObject json) throws JSONException {
                String symbolId = (String) json.get("symbolId");
                System.out.println("   symbolId=" + symbolId);
                Integer idCur = (Integer) json.get("idCur");
                System.out.println("   idCur=" + idCur);
                JSONObject payload = (JSONObject) json.get("payload");
                System.out.println("   payload=" + payload);
                Double totalVolume = (Double) payload.get("totalVolume");
                System.out.println("    totalVolume=" + totalVolume);
                JSONObject trades = (JSONObject) payload.get("trades");
                System.out.println("    trades=" + trades);
                {
                    JSONArray amount = (JSONArray) trades.get("amount");
                    System.out.println("     amount=" + amount);
                    System.out.println("      .length=" + amount.length());
                    JSONArray price = (JSONArray) trades.get("price");
                    System.out.println("     price=" + price);
                    System.out.println("      .length=" + price.length());
                    JSONArray time = (JSONArray) trades.get("time");
                    System.out.println("     time=" + time);
                    System.out.println("      .length=" + time.length());
                    JSONArray direction = (JSONArray) trades.get("direction");
                    System.out.println("     direction=" + direction);
                    System.out.println("      .length=" + direction.length());
                }
                JSONObject asks = (JSONObject) payload.get("asks");
                System.out.println("    asks=" + asks);
                {
                    JSONArray amount = (JSONArray) asks.get("amount");
                    System.out.println("     amount=" + amount);
                    System.out.println("      .length=" + amount.length());
                    JSONArray price = (JSONArray) asks.get("price");
                    System.out.println("     price=" + price);
                    System.out.println("      .length=" + price.length());
                    JSONArray accuAmount = (JSONArray) asks.get("accuAmount");
                    System.out.println("     accuAmount=" + accuAmount);
                    System.out.println("      .length=" + accuAmount.length());
                }
                JSONObject bids = (JSONObject) payload.get("bids");
                System.out.println("    bids=" + bids);
                {
                    JSONArray amount = (JSONArray) bids.get("amount");
                    System.out.println("     amount=" + amount);
                    System.out.println("      .length=" + amount.length());
                    JSONArray price = (JSONArray) bids.get("price");
                    System.out.println("     price=" + price);
                    System.out.println("      .length=" + price.length());
                    JSONArray accuAmount = (JSONArray) bids.get("accuAmount");
                    System.out.println("     accuAmount=" + accuAmount);
                    System.out.println("      .length=" + accuAmount.length());
                }
            }
        });
    }

    private void sendSubscribe() {
        // reqSymbolList: Request symbol list.
//String str = "[{\"version\":1,\"msgType\":\"reqSymbolList\",\"requestIndex\":1405141205513}]";
// response:
// [{"msgType":"reqSymbolList",
//   "payload":{"exchangeId":["huobi","huobi"],
//              "symbolId":["btccny","ltccny"],
//              "currencyName":["人民币","人民币"],
//              "cryptoName":["bitcoin","litecoin"],
//              "cryptoId":["btc","ltc"],
//              "symbolName":["比特币人民币","莱特币人民币"],
//              "exchangeName":["火币","火币"],
//              "currencyId":["cny","cny"]},
//              "requestIndex":1405141205513,
//              "retCode":200,
//              "version":1,
//              "retMsg":""}]

// reqSymbolDetail: Request symbol details.
//String str = "[{\"version\":1,\"msgType\":\"reqSymbolDetail\",\"symbolIdList\":[\"btccny\",\"ltccny\"],\"requestIndex\":1405141205513}]";
// response:
// [{"msgType":"reqSymbolDetail",
//   "payload":{"exchangeId":["huobi","huobi"],
//              "suply":[12000000,40000000],
//              "symbolId":["btccny","ltccny"],
//              "total":[21000000,84000000],
//              "currencyName":["人民币","人民币"],
//              "cryptoName":["bitcoin","litecoin"],
//              "cryptoId":["btc","ltc"],
//              "symbolName":["比特币人民币","莱特币人民币"],
//              "exchangeName":["火币","火币"],
//              "currencyId":["cny","cny"],
//              "introduction":["火币上的比特币人民币交易","火币上的莱特币人民币交易"]},
//              "requestIndex":1405141205513,
//              "retCode":200,
//              "version":1,
//              "retMsg":""}]

// reqMarketDepthTop: Get full Top market-depth. Push top 150 market-depth data.
//String str = "[{\"symbolId\":\"btccny\",\"version\":1,\"msgType\":\"reqMarketDepthTop\",\"requestIndex\":1405131205513}]";
// response:
// [{"msgType":"reqMarketDepthTop",
//   "payload":{"symbolId":"btccny",
//              "askPrice":[2236.5,2238.12,2239.38,2239.4,2239.46,2239.6,2239.7,2239.9,2240,2240.46,2240.49,2240.96,2241.53,2241.81,2242.12,2242.14,2242.22,2242.77,2243.52,2244,2245,2245.76,2246,2246.72,2247,2247.52,2248.9,2249,2249.08,2249.41,2249.65,2249.67,2249.8,2250,2251.52,2252,2252.11,2253,2253.04,2254,2254.23,2254.98,2255,2256,2256.3,2256.7,2257,2257.01,2257.41,2258,2258.2,2258.9,2259,2259.51,2260,2260.19,2260.25,2260.34,2260.37,2260.38,2260.39,2260.48,2260.55,2260.6,2260.73,2260.87,2260.98,2261,2261.06,2261.14,2261.16,2261.17,2261.29,2261.38,2261.41,2261.47,2261.71,2261.8,2261.91,2262.01,2262.05,2262.17,2262.23,2262.28,2262.31,2262.46,2262.65,2262.69,2262.82,2262.92,2263,2263.07,2263.17,2263.33,2263.44,2263.52,2263.58,2263.59,2263.64,2263.66,2263.73,2263.76,2263.86,2264.32,2264.54,2264.61,2264.69,2264.81,2264.85,2264.86,2264.89,2264.92,2265,2265.17,2265.25,2265.28,2265.33,2265.37,2265.39,2265.41,2265.44,2265.48,2265.8,2265.91,2266,2266.1,2266.16,2266.19,2266.21,2266.25,2266.31,2266.48,2266.5,2266.66,2266.69,2266.75,2266.78,2266.98,2267,2267.16,2267.21,2267.33,2267.54,2267.56,2267.59,2267.64,2267.77,2267.79,2267.96,2268],
//              "askTotal":[1.0557,1.3157,1.3257,1.4257,1.8967,2.6567,3.6567,4.6567,8.6567,8.6907,12.1907,12.2907,16.1543,16.1573,16.1743,16.3499,17.1499,18.1589,18.6535,20.5408,67.8635,68.0635,73.6414,76.5882,79.6661,86.8187,96.8189,134.5419,134.5719,140.5719,144.0742,144.0772,148.0472,272.6412,272.6442,273.3442,283.3442,361.0664,361.0694,368.0694,368.2954,368.2984,439.1658,605.1978,605.2053,610.8863,611.338,611.352,623.352,653.352,654.5098,654.5276,724.6037,724.6237,919.513,919.9021,920.4085,920.7247,921.1328,921.5936,921.7152,922.1271,922.2877,922.738,923.0524,923.4467,923.9556,926.8959,927.2151,927.6548,928.0948,928.5956,929.0716,929.417,929.9251,930.1773,930.563,930.8845,931.0067,932.0661,932.0671,932.4334,932.9097,933.0894,933.3974,933.8234,934.2855,934.7899,935.1459,935.6219,935.8921,936.3521,936.8276,937.1722,937.3391,937.8483,938.1596,938.601,939.0072,939.0082,939.4013,939.8814,940.2003,940.584,940.9762,941.3707,942.2251,942.5789,942.9061,943.2679,943.5745,943.5755,1084.6825,1085.1098,1085.4197,1085.9199,1086.3282,1086.6838,1087.0883,1087.4544,1087.9564,1088.3785,1088.686,1088.8372,1196.2668,1196.764,1197.1407,1197.5171,1197.8327,1197.8337,1198.1741,1198.3637,1200.3439,1200.8149,1201.1232,1201.5538,1202.0487,1202.3976,1248.9589,1249.3363,1249.8319,1250.282,1250.6221,1251.5209,1251.6529,1252.0072,1252.3191,1252.7795,1253.1199,1257.4817],
//              "askName":"累计卖单",
//              "bidAmount":[3.86,2.17,0.0763,0.01,0.0867,1.591,0.2131,0.1,7,0.101,0.789,0.8,0.09,32.5533,3.5,3.5,3.0089,7,3.5,3.5,1.9339,6,1.43,4.979,29.5755,12.3936,86.1188,0.16,0.04,0.001,19.422,0.01,0.179,0.2148,0.38,74.4133,0.44,0.0483,0.2,0.04,50,0.14,38.2811,12.7853,0.4765,0.3762,0.3444,0.4167,0.4599,0.3398,0.4858,0.973,0.5253,0.001,0.3741,0.4864,0.4516,0.4875,2,0.4694,0.4438,0.4224,0.8446,0.5,1.3449,0.4198,1.5893,12,0.8765,0.492,0.3572,0.4261,0.4733,0.3805,0.4808,0.5126,0.4403,0.3971,0.5172,1,0.3712,0.3321,0.4089,0.3317,0.4839,0.3706,0.4054,0.3695,0.3876,0.4132,0.4346,0.8694,43.2376,84.0957,56.164,0.4553,0.37,0.4117,0.3591,0.4372,0.4219,0.4077,0.4036,0.3681,0.3743,0.3388,0.8375,0.365,0.4998,0.4309,0.3837,307.3083,0.01,15,46.5064,0.6267,1.088,0.007,23.6947,0.0034,183.7607,15.7221,6,6.1368,7.0032,4.4804,5.6242,5.4576,3.8417,8,100,0.5,7.0714,8.4479,7.05,0.9965,0.8069,16.0335,2.301,20,27.7117,0.552,1.0908,2.1119,2.4787,100,37,160.2274,7.3312,0.1],
//              "time":1415745961806,
//              "version":1415745961806,
//              "bidName":"累计买单",
//              "bidTotal":[3.86,6.03,6.1063,6.1163,6.203,7.794,8.0071,8.1071,15.1071,15.2081,15.9971,16.7971,16.8871,49.4404,52.9404,56.4404,59.4493,66.4493,69.9493,73.4493,75.3832,81.3832,82.8132,87.7922,117.3677,129.7613,215.8801,216.0401,216.0801,216.0811,235.5031,235.5131,235.6921,235.9069,236.2869,310.7002,311.1402,311.1885,311.3885,311.4285,361.4285,361.5685,399.8496,412.6349,413.1114,413.4876,413.832,414.2487,414.7086,415.0484,415.5342,416.5072,417.0325,417.0335,417.4076,417.894,418.3456,418.8331,420.8331,421.3025,421.7463,422.1687,423.0133,423.5133,424.8582,425.278,426.8673,438.8673,439.7438,440.2358,440.593,441.0191,441.4924,441.8729,442.3537,442.8663,443.3066,443.7037,444.2209,445.2209,445.5921,445.9242,446.3331,446.6648,447.1487,447.5193,447.9247,448.2942,448.6818,449.095,449.5296,450.399,493.6366,577.7323,633.8963,634.3516,634.7216,635.1333,635.4924,635.9296,636.3515,636.7592,637.1628,637.5309,637.9052,638.244,639.0815,639.4465,639.9463,640.3772,640.7609,948.0692,948.0792,963.0792,1009.5856,1010.2123,1011.3003,1011.3073,1035.002,1035.0054,1218.7661,1234.4882,1240.4882,1246.625,1253.6282,1258.1086,1263.7328,1269.1904,1273.0321,1281.0321,1381.0321,1381.5321,1388.6035,1397.0514,1404.1014,1405.0979,1405.9048,1421.9383,1424.2393,1444.2393,1471.951,1472.503,1473.5938,1475.7057,1478.1844,1578.1844,1615.1844,1775.4118,1782.743,1782.843],
//              "bidPrice":[2236.49,2236.48,2236.46,2236.27,2236.15,2235.22,2235.14,2235,2234.36,2233.65,2233.61,2233.59,2233.25,2233,2231.75,2231.72,2231,2230.7,2230.05,2229.64,2229.1,2228.51,2228.5,2228,2226.31,2226.3,2226,2225.99,2225.61,2225.42,2225,2224.16,2223.35,2223.3,2222.25,2222.22,2222.21,2222.19,2222.07,2222.04,2222,2220.37,2220.01,2220,2219.98,2219.94,2219.92,2219.91,2219.67,2219.64,2219.59,2219.48,2219.33,2219.31,2219.26,2219.21,2218.96,2218.85,2218.8,2218.69,2218.58,2218.5,2218.48,2218.42,2218.36,2218.34,2218,2217.77,2217.55,2217.52,2217.5,2217.48,2217.42,2217.4,2217.37,2217.29,2217.23,2217.21,2217.19,2217,2216.94,2216.89,2216.82,2216.6,2216.59,2216.53,2216.51,2216.42,2216.39,2216.31,2216.19,2216.15,2216.14,2216.13,2216.12,2216.08,2216,2215.83,2215.77,2215.69,2215.55,2215.46,2215.42,2215.41,2215.39,2215.37,2215.36,2215.3,2215.12,2215.09,2215.08,2215,2213.12,2213.1,2212.95,2211.85,2211.03,2211.01,2211,2210.93,2210,2208.52,2208.31,2208.21,2208,2207.45,2207.07,2207,2206.7,2206.1,2205.95,2205.1,2205,2204,2203.99,2203.71,2203.53,2203.1,2203,2202.02,2202,2201.85,2201.79,2201.04,2201,2200.95,2200.01,2200,2199.99,2199.98],
//              "askAmount":[1.0557,0.26,0.01,0.1,0.471,0.76,1,1,4,0.034,3.5,0.1,3.8636,0.003,0.017,0.1756,0.8,1.009,0.4946,1.8873,47.3227,0.2,5.5779,2.9468,3.0779,7.1526,10.0002,37.723,0.03,6,3.5023,0.003,3.97,124.594,0.003,0.7,10,77.7222,0.003,7,0.226,0.003,70.8674,166.032,0.0075,5.681,0.4517,0.014,12,30,1.1578,0.0178,70.0761,0.02,194.8893,0.3891,0.5064,0.3162,0.4081,0.4608,0.1216,0.4119,0.1606,0.4503,0.3144,0.3943,0.5089,2.9403,0.3192,0.4397,0.44,0.5008,0.476,0.3454,0.5081,0.2522,0.3857,0.3215,0.1222,1.0594,0.001,0.3663,0.4763,0.1797,0.308,0.426,0.4621,0.5044,0.356,0.476,0.2702,0.46,0.4755,0.3446,0.1669,0.5092,0.3113,0.4414,0.4062,0.001,0.3931,0.4801,0.3189,0.3837,0.3922,0.3945,0.8544,0.3538,0.3272,0.3618,0.3066,0.001,141.107,0.4273,0.3099,0.5002,0.4083,0.3556,0.4045,0.3661,0.502,0.4221,0.3075,0.1512,107.4296,0.4972,0.3767,0.3764,0.3156,0.001,0.3404,0.1896,1.9802,0.471,0.3083,0.4306,0.4949,0.3489,46.5613,0.3774,0.4956,0.4501,0.3401,0.8988,0.132,0.3543,0.3119,0.4604,0.3404,4.3618]},
//              "requestIndex":1405131205513,
//              "retCode":200,
//              "version":1,
//              "retMsg":""}]

//String str = "[{\"symbolId\":\"btccny\",\"version\":1,\"msgType\":\"reqMarketDepth\",\"requestIndex\":1405131205518,\"percent\":10}]";
// response:
// [{"msgType":"reqMarketDepth",
//   "payload":{"symbolId":"btccny",
//              "askPrice":[2235.6,2237.1004026845635,2238.6008053691276,2240.1012080536916,2241.601610738255,2243.102013422819,2244.6024161073824,2246.1028187919464,2247.60322147651,2249.1036241610736,2250.6040268456377,2252.1044295302013,2253.6048322147653,2255.105234899329,2256.6056375838925,2258.106040268456,2259.60644295302,2261.106845637584,2262.607248322148,2264.1076510067114,2265.608053691275,2267.108456375839,2268.6088590604027,2270.1092617449663,2271.60966442953,2273.1100671140944,2274.610469798658,2276.1108724832216,2277.611275167785,2279.1116778523487,2280.612080536913,2282.1124832214764,2283.6128859060404,2285.113288590604,2286.613691275168,2288.1140939597317,2289.6144966442953,2291.114899328859,2292.6153020134225,2294.1157046979865,2295.6161073825506,2297.116510067114,2298.616912751678,2300.117315436242,2301.6177181208054,2303.118120805369,2304.6185234899326,2306.1189261744967,2307.6193288590607,2309.1197315436243,2310.620134228188,2312.1205369127515,2313.6209395973156,2315.121342281879,2316.6217449664427,2318.122147651007,2319.6225503355704,2321.1229530201344,2322.623355704698,2324.1237583892616,2325.6241610738252,2327.1245637583893,2328.6249664429533,2330.125369127517,2331.6257718120805,2333.126174496644,2334.626577181208,2336.126979865772,2337.6273825503354,2339.1277852348994,2340.6281879194635,2342.128590604027,2343.6289932885907,2345.1293959731543,2346.629798657718,2348.130201342282,2349.6306040268455,2351.1310067114096,2352.631409395973,2354.1318120805367,2355.632214765101,2357.1326174496644,2358.633020134228,2360.1334228187916,2361.6338255033556,2363.1342281879197,2364.6346308724833,2366.135033557047,2367.635436241611,2369.1358389261745,2370.636241610738,2372.136644295302,2373.6370469798658,2375.13744966443,2376.6378523489934,2378.138255033557,2379.6386577181206,2381.139060402684,2382.6394630872483,2384.1398657718123,2385.640268456376,2387.1406711409395,2388.6410738255036,2390.141476510067,2391.6418791946307,2393.1422818791943,2394.6426845637584,2396.1430872483224,2397.643489932886,2399.1438926174496,2400.6442953020132,2402.1446979865773,2403.645100671141,2405.1455033557045,2406.6459060402685,2408.146308724832,2409.646711409396,2411.1471140939598,2412.6475167785234,2414.147919463087,2415.648322147651,2417.148724832215,2418.6491275167787,2420.1495302013423,2421.649932885906,2423.15033557047,2424.6507382550335,2426.151140939597,2427.651543624161,2429.151946308725,2430.652348993289,2432.1527516778524,2433.653154362416,2435.1535570469796,2436.6539597315436,2438.1543624161072,2439.6547651006713,2441.155167785235,2442.655570469799,2444.1559731543625,2445.656375838926,2447.1567785234897,2448.6571812080533,2450.1575838926174,2451.6579865771814,2453.158389261745,2454.6587919463086,2456.1591946308727,2457.6595973154363,2459.16],
//              "askTotal":[0.077,0.5523,7.4119,104.5177,108.8928,113.5352,118.4875,171.0881,184.2654,238.0186,279.7822,279.9852,367.7104,445.8068,611.8463,659.993,731.2647,934.3071,940.9154,947.2923,1095.4705,1256.0509,1265.9977,1378.6201,1378.6512,1380.8311,1402.3311,1438.1144,1453.0349,1479.2306,2176.0468,2185.5468,2257.9717,2283.8589,2290.0599,2315.6621,2325.5709,2375.9087,2386.1827,2390.1827,2394.4659,2394.7649,2401.7315,2597.1243,2653.3165,2653.3665,2653.3665,2663.7857,2663.7857,2707.6257,2716.6628,2716.8628,2717.0352,2730.1638,2733.1638,2743.2498,2750.2698,2784.7879,2808.4197,2808.4197,2808.4652,2848.4969,2858.4969,3050.0479,3057.2018,3059.8463,3059.8463,3201.3973,3203.3973,3338.1424,3476.2485,3626.6163,3867.7381,3877.7656,3881.4658,3995.8824,3998.4551,4170.1875,4185.9875,4189.6908,4189.8508,4195.1703,4196.9862,4219.6904,4220.1779,4220.5866,4221.6042,4221.6618,4221.6755,4254.7857,4310.3635,4310.5635,4310.5635,4356.6362,4356.862,4357.622,4368.622,4384.9657,4384.9657,4384.9657,4401.3687,4401.7048,4432.064,4457.9038,4458.4038,4458.4884,4460.5491,4502.8459,4502.8659,4530.7421,4668.3676,4671.0876,4683.7036,4705.4485,4706.4485,4706.8509,4708.8509,4717.3547,4717.3627,4717.5499,4729.0219,4729.0219,4735.7719,4744.7502,4744.7502,4751.1256,4778.1788,4779.5976,4779.6715,4798.6987,4808.7504,4808.7504,4808.9004,4809.4004,4809.4163,4859.6757,4861.1254,4889.1629,4889.1629,4895.8614,4905.9778,4906.7065,5023.9618,5063.804,5065.065,5065.945,5065.945,5065.995,5065.995,5068.4472],
//              "askName":"累计卖单",
//              "bidAmount":[1.218,3.0468,22.3726,23.6061,12.3882,13.3639,4.979,108.7134,7.01,1.5021,50,66.4655,21.8498,151.3702,323.7176,15.01,47.1331,30.124,310.5805,44.9667,117.2993,7.5714,35.6358,51.4664,333.6125,96.2546,57.146,0.2508,22.8761,15,36.6291,114.5917,149.1024,50,107.4145,31.7044,51.1155,11.1331,76.7667,3.515,2.3695,6.5958,4.979,5.5058,321.3879,0.25,171.0436,1.4664,128.5941,13.0654,16.1264,10.4583,113.3697,16.3155,28.6851,12.0561,120.7492,4.06,300.1706,0.66,0.2,206.7636,38.6715,34.3537,81.0335,0.68,0.21,3.2,136.1675,32.1764,101.1408,0.1423,0.16,0,1.347,16.0661,0.32,17.8437,11.271,0.25,11.9975,28.279,1018.1671,0,1.001,4.7059,0,0.6,0.5993,330.871,79.7002,203.0144,1,82.2883,0.5,0,0.05,22.2333,14.7694,2.6062,1.48,4.6416,1.143,10.0307,19.3868,0.19,5.03,0,6.012,0.2071,1,9.0385,0,0,0,0.2908,0.3031,6.2201,0.4048,0.05,1.4616,16.6301,0.0658,1.1,30.6031,0,0,0.2,0,81.4642,1,6.001,0,0.3,0.06,0,0,14.9782,0,0,11.46,10.2602,0.9243,3,25.4011,0.05,0,65.1045,0.35,0],
//              "time":1415747110000,
//              "percent":"10",
//              "version":1415747110000,
//              "bidName":"累计买单",
//              "bidTotal":[1.218,4.2648,26.6374,50.2435,62.6317,75.9956,80.9746,189.688,196.698,198.2001,248.2001,314.6656,336.5154,487.8856,811.6032,826.6132,873.7463,903.8703,1214.4508,1259.4175,1376.7168,1384.2882,1419.924,1471.3904,1805.0029,1901.2575,1958.4035,1958.6543,1981.5304,1996.5304,2033.1595,2147.7512,2296.8536,2346.8536,2454.2681,2485.9725,2537.088,2548.2211,2624.9878,2628.5028,2630.8723,2637.4681,2642.4471,2647.9529,2969.3408,2969.5908,3140.6344,3142.1008,3270.6949,3283.7603,3299.8867,3310.345,3423.7147,3440.0302,3468.7153,3480.7714,3601.5206,3605.5806,3905.7512,3906.4112,3906.6112,4113.3748,4152.0463,4186.4,4267.4335,4268.1135,4268.3235,4271.5235,4407.691,4439.8674,4541.0082,4541.1505,4541.3105,4541.3105,4542.6575,4558.7236,4559.0436,4576.8873,4588.1583,4588.4083,4600.4058,4628.6848,5646.8519,5646.8519,5647.8529,5652.5588,5652.5588,5653.1588,5653.7581,5984.6291,6064.3293,6267.3437,6268.3437,6350.632,6351.132,6351.132,6351.182,6373.4153,6388.1847,6390.7909,6392.2709,6396.9125,6398.0555,6408.0862,6427.473,6427.663,6432.693,6432.693,6438.705,6438.9121,6439.9121,6448.9506,6448.9506,6448.9506,6448.9506,6449.2414,6449.5445,6455.7646,6456.1694,6456.2194,6457.681,6474.3111,6474.3769,6475.4769,6506.08,6506.08,6506.08,6506.28,6506.28,6587.7442,6588.7442,6594.7452,6594.7452,6595.0452,6595.1052,6595.1052,6595.1052,6610.0834,6610.0834,6610.0834,6621.5434,6631.8036,6632.7279,6635.7279,6661.129,6661.179,6661.179,6726.2835,6726.6335,6726.6335],
//              "bidPrice":[2235.54,2234.0396375838927,2232.539275167785,2231.038912751678,2229.53855033557,2228.0381879194633,2226.5378255033556,2225.0374630872484,2223.537100671141,2222.0367382550335,2220.5363758389262,2219.0360134228185,2217.5356510067113,2216.035288590604,2214.5349261744964,2213.0345637583896,2211.534201342282,2210.0338389261747,2208.533476510067,2207.0331140939597,2205.5327516778525,2204.032389261745,2202.5320268456376,2201.03166442953,2199.5313020134226,2198.0309395973154,2196.530577181208,2195.030214765101,2193.5298523489932,2192.029489932886,2190.5291275167783,2189.028765100671,2187.528402684564,2186.028040268456,2184.527677852349,2183.0273154362417,2181.5269530201344,2180.0265906040268,2178.5262281879195,2177.0258657718123,2175.5255033557046,2174.0251409395973,2172.5247785234897,2171.0244161073824,2169.524053691275,2168.023691275168,2166.5233288590607,2165.022966442953,2163.522604026846,2162.022241610738,2160.521879194631,2159.0215167785236,2157.521154362416,2156.0207919463087,2154.520429530201,2153.020067114094,2151.5197046979865,2150.0193422818793,2148.518979865772,2147.0186174496644,2145.518255033557,2144.0178926174494,2142.517530201342,2141.017167785235,2139.5168053691273,2138.0164429530205,2136.516080536913,2135.0157181208056,2133.515355704698,2132.0149932885906,2130.5146308724834,2129.0142684563757,2127.5139060402685,2126.013543624161,2124.5131812080535,2123.0128187919463,2121.512456375839,2120.012093959732,2118.511731543624,2117.011369127517,2115.511006711409,2114.010644295302,2112.5102818791947,2111.009919463087,2109.50955704698,2108.0091946308726,2106.5088322147653,2105.0084697986576,2103.5081073825504,2102.007744966443,2100.5073825503355,2099.0070201342282,2097.5066577181206,2096.0062953020133,2094.505932885906,2093.005570469799,2091.5052080536916,2090.004845637584,2088.5044832214767,2087.004120805369,2085.5037583892617,2084.0033959731545,2082.503033557047,2081.0026711409396,2079.502308724832,2078.001946308725,2076.5015838926174,2075.00122147651,2073.500859060403,2072.0004966442953,2070.500134228188,2068.9997718120803,2067.499409395973,2065.999046979866,2064.4986845637586,2062.9983221476514,2061.4979597315437,2059.9975973154365,2058.4972348993288,2056.9968724832215,2055.4965100671143,2053.9961476510066,2052.4957852348994,2050.9954228187917,2049.4950604026844,2047.9946979865774,2046.49433557047,2044.9939731543625,2043.493610738255,2041.9932483221476,2040.4928859060403,2038.9925234899329,2037.4921610738254,2035.991798657718,2034.491436241611,2032.9910738255035,2031.490711409396,2029.9903489932888,2028.4899865771813,2026.9896241610738,2025.4892617449664,2023.988899328859,2022.4885369127517,2020.9881744966442,2019.4878120805367,2017.9874496644297,2016.4870872483223,2014.9867248322148,2013.4863624161073,2011.986],
//              "askAmount":[0.077,0.4753,6.8596,97.1058,4.3751,4.6424,4.9523,52.6006,13.1773,53.7532,41.7636,0.203,87.7252,78.0964,166.0395,48.1467,71.2717,203.0424,6.6083,6.3769,148.1782,160.5804,9.9468,112.6224,0.0311,2.1799,21.5,35.7833,14.9205,26.1957,696.8162,9.5,72.4249,25.8872,6.201,25.6022,9.9088,50.3378,10.274,4,4.2832,0.299,6.9666,195.3928,56.1922,0.05,0,10.4192,0,43.84,9.0371,0.2,0.1724,13.1286,3,10.086,7.02,34.5181,23.6318,0,0.0455,40.0317,10,191.551,7.1539,2.6445,0,141.551,2,134.7451,138.1061,150.3678,241.1218,10.0275,3.7002,114.4166,2.5727,171.7324,15.8,3.7033,0.16,5.3195,1.8159,22.7042,0.4875,0.4087,1.0176,0.0576,0.0137,33.1102,55.5778,0.2,0,46.0727,0.2258,0.76,11,16.3437,0,0,16.403,0.3361,30.3592,25.8398,0.5,0.0846,2.0607,42.2968,0.02,27.8762,137.6255,2.72,12.616,21.7449,1,0.4024,2,8.5038,0.008,0.1872,11.472,0,6.75,8.9783,0,6.3754,27.0532,1.4188,0.0739,19.0272,10.0517,0,0.15,0.5,0.0159,50.2594,1.4497,28.0375,0,6.6985,10.1164,0.7287,117.2553,39.8422,1.261,0.88,0,0.05,0,2.4522]},
//              "requestIndex":1405131205518,
//              "retCode":200,
//              "version":1,
//              "retMsg":""}]

//String str = "[{\"symbolId\":\"btccny\",\"version\":1,\"msgType\":\"reqTradeDetailTop\",\"requestIndex\":1405131205518,\"Count\":10}]";
// response:
// [{"msgType":"reqTradeDetailTop",
//   "payload":{"symbolId":"btccny",
//              "amount":[0.084,0.08,0.06,1.4934,0.019,0.88,0.18,0.01,0.019,2.17,0.343,0.034,0.0809,0.019,0.41,0.001,0.005,0.002,0.0075,0.1,0.235,0.236,0.003,0.1,0.33,0.2021,0.41,0.02,0.148,0.5,0.5,0.16,0.4272,0.0728,0.2,0.0769,0.1936,0.0272,0.0592,0.08,0.058,0.229,0.001,0.002,0.005,0.052,0.448,0.02,0.2,0.2,1.5872,0.0283,0.5,0.052,0.2,0.5,0.5,0.49,0.507,0.0979,0.4021,0.49,0.5,0.064,0.136,0.2,0.2,0.0637,0.5384,0.05,0.1,0.01,0.0199,1.71,0.14,0.4114,0.471,0.0199,0.4511,0.1,0.471,0.471,0.04,0.018,0.1,0.182,0.3,1.1059,0.1737,0.06,0.004,0.1151,1.5874,0.0075,0.1254,0.1839,0.1,2.67,1.58,0.6825,0.405,1.1824,0.184,0.5,0.1024,0.1,0.121,0.0599,0.8012,0.7334,0.059,0.01,0.5,0.475,0.05,0.7208,1.218,0.1841,1.6307,0.1,0.023,0.2,0.36,0.68,1.18,0.016,0.01,0.13,2.31,2.2656,0.0655,0.9989,0.5,0.5,0.1,0.02,0.3212,0.0011,0.9789,0.1004,0.2,0.687,0.3631,0.091,0.178,0.0992,0.2191,0.277,0.02,0.02,0.183,0.277,0.0557,0.0025,0.5,0.1858,0.026,0.018,0.002,1.35,0.06,0.367,0.0204,0.1025,0.03,0.04,0.2,0.02,0.162,0.055,0.107,0.16,0.5,0.039,0.017,0.395,0.2171,0.0185,0.3641,0.1841,0.1159,0.5995,0.5,0.1,0.5,1.207,4,0.7229,3.33,0.0865,0.48,0.077,0.1,0.0233,0.0463,0.0404,0.3685,0.2015,0.023,0.064,0.01,0.455,0.01,0.4435,0.077,0.03,0.37,0.113,0.024,0.012,0.0616,0.012,0.0477,0.0199,0.1481,0.1232,0.123,0.0464,0.112,0.3206,0.479,0.479,0.479,0.479,0.112,0.024,0.343,0.136,1.437,0.0075,0.0447,0.01,0.1,0.1087,0.1,0.4264,0.15,0.01,0.023,0.177,0.0523,0.1958,0.23,0.0429,0.0241,0.1,0.024,0.3,1.74,0.157,0.001,0.002,0.005,1.4643,0.4737,0.5,0.024,0.476,0.1957,0.98,0.72,0.26,0.2041,0.388,0.3879,0.157,0.024,0.5111,0.1,0.316,0.204,0.275,0.254,0.2322,0.0852,0.47,0.478,1.62,0.01,0.1848,0.98,0.216,0.1,0.1822,0.4818,0.016,0.944,0.1465,0.0774,0.1,0.0033,0.1,0.02,0.364,0.026,0.1,0.1,2.32,1.42,2.18],
//              "price":[2236.88,2236.88,2236.88,2236.88,2236.88,2236.88,2236.88,2236.88,2236.89,2236.94,2236.94,2237.01,2237.01,2237.39,2237.05,2237.4,2237.4,2237.4,2237.4,2237.56,2237.61,2237.61,2237.61,2237.41,2237.34,2237.44,2237.39,2237.45,2237.45,2236.93,2236.9,2236.98,2236.98,2236.93,2236.93,2237.33,2236.88,2236.56,2235.95,2236.86,2236.88,2236.89,2236.41,2236.41,2236.41,2235.75,2235.68,2235.68,2235.68,2236.43,2236.73,2236.91,2235.68,2235.68,2235.76,2235.77,2235.77,2235.77,2235.95,2235.77,2235.76,2235.68,2235.68,2235.76,2235.76,2235.77,2235.77,2235.91,2235.91,2236.39,2236.39,2236.41,2236.88,2235.99,2235.99,2235.99,2235.68,2235.73,2235.68,2235.68,2235.68,2235.68,2235.68,2235.95,2235.98,2236.25,2236.25,2236.25,2236.3,2236.84,2236.84,2236.85,2236.95,2236.56,2236.5,2236.5,2236.5,2236.5,2236.5,2236.5,2236.66,2236.54,2236.71,2236.71,2236.58,2236.72,2236.5,2236.13,2235.73,2235.68,2237.35,2237.42,2237.57,2237.61,2238,2238.13,2235.85,2235.81,2235.68,2235.85,2235.85,2235.68,2235.68,2235.68,2235.68,2235.68,2235.68,2235.68,2235.68,2235.68,2235.61,2235.61,2235.63,2235.58,2234.72,2235.35,2235.31,2234.72,2234.23,2234.18,2234.18,2234.18,2234.17,2234.17,2233.48,2233.48,2233.48,2231.98,2231.98,2231.98,2231.98,2231.97,2232.19,2231.92,2231.9,2231.46,2231.33,2231.97,2231.33,2231.33,2231.44,2231.43,2232.18,2232.47,2231.43,2231.43,2231.43,2231.43,2231.43,2231.43,2231.44,2231.4,2231.4,2231.4,2231.4,2231.4,2231.46,2232.47,2233.32,2233.31,2233.32,2233.32,2233.06,2233.32,2231.79,2231.48,2231.45,2231.44,2231.44,2231.43,2231.83,2231.84,2231.94,2231.94,2232.55,2233.01,2233.01,2233.06,2232.55,2231.9,2231.9,2231.9,2231.9,2231.9,2232.96,2232.9,2232.17,2233.48,2233.47,2233.37,2233.47,2233.47,2233.48,2233.82,2233.82,2233.83,2233.87,2233.89,2233.88,2233.87,2233.92,2233.92,2233.97,2233.96,2234.5,2234.5,2234.51,2234.51,2234.55,2234.64,2234.64,2234.72,2234.77,2234.77,2234.92,2235,2235.05,2235.05,2235.38,2235.38,2235.33,2235.02,2234.98,2235.03,2235.03,2234.59,2234.64,2234.6,2234.6,2234.6,2234.4,2234.4,2234.4,2234.05,2234,2234,2234.01,2234,2234.31,2234.33,2234.34,2234.33,2234.33,2234.31,2234.31,2234.54,2234.54,2234.55,2234.54,2234.55,2234.54,2234.55,2234.55,2234.55,2234.54,2234.52,2234.6,2234.91,2234.93,2235.25,2234.57,2234.57,2234.52,2234.19,2234.19,2234.57,2234.57,2234.62,2234.53,2234.34,2234.34,2234.34,2234.03,2234.03,2234,2234.32,2234.28,2234,2234,2234],
//              "topAsks":[{"amount":[2.513,0.1149,0.03,0.0155,0.1],
//                          "level":[0,0,0,0,0],
//                          "price":[2236.94,2237.01,2237.05,2237.4,2237.56],
//                          "accuAmount":[2.513,2.6279,2.6579,2.6734,2.7734]},
//                         {"amount":[2.513,0.1149,0.03,0.0155,0.1],
//                          "level":[0,0,0,0,0],
//                          "price":[2236.94,2237.01,2237.05,2237.4,2237.56],
//                          "accuAmount":[2.513,2.6279,2.6579,2.6734,2.7734]},
//                         {"amount":[2.513,0.1149,0.03,0.0155,0.1],
//                          "level":[0,0,0,0,0],
//                          "price":[2236.94,2237.01,2237.05,2237.4,2237.56],
//                          "accuAmount":[2.513,2.6279,2.6579,2.6734,2.7734]}, ...
//                        ],
//              "time":[1415746947,1415746947,1415746947,1415746947,1415746950,1415746951,1415746951,1415746951,1415746953,1415746956,1415746956,1415746957,1415746959,1415746963,1415746965,1415746965,1415746965,1415746965,1415746965,1415746967,1415746970,1415746972,1415746972,1415746973,1415746975,1415746983,1415746984,1415746984,1415746984,1415746985,1415746985,1415746986,1415746986,1415746987,1415746987,1415746987,1415746989,1415746989,1415746989,1415746992,1415746992,1415746992,1415746996,1415746996,1415746996,1415746997,1415746997,1415746997,1415746997,1415746998,1415746998,1415746998,1415746998,1415746998,1415746998,1415746999,1415746999,1415746999,1415746999,1415747000,1415747000,1415747000,1415747001,1415747001,1415747003,1415747003,1415747003,1415747003,1415747004,1415747005,1415747005,1415747005,1415747005,1415747005,1415747005,1415747005,1415747009,1415747012,1415747012,1415747013,1415747014,1415747016,1415747019,1415747030,1415747030,1415747030,1415747031,1415747031,1415747031,1415747035,1415747035,1415747035,1415747044,1415747045,1415747046,1415747047,1415747048,1415747048,1415747048,1415747048,1415747048,1415747048,1415747051,1415747053,1415747053,1415747060,1415747060,1415747060,1415747060,1415747060,1415747069,1415747069,1415747069,1415747069,1415747069,1415747069,1415747076,1415747077,1415747077,1415747078,1415747078,1415747080,1415747084,1415747084,1415747085,1415747085,1415747087,1415747087,1415747087,1415747087,1415747087,1415747087,1415747097,1415747102,1415747115,1415747116,1415747120,1415747120,1415747120,1415747125,1415747125,1415747125,1415747126,1415747126,1415747130,1415747130,1415747130,1415747134,1415747135,1415747135,1415747136,1415747136,1415747138,1415747138,1415747138,1415747138,1415747138,1415747138,1415747138,1415747139,1415747139,1415747141,1415747141,1415747141,1415747142,1415747142,1415747142,1415747142,1415747142,1415747142,1415747142,1415747142,1415747143,1415747143,1415747144,1415747145,1415747145,1415747145,1415747145,1415747146,1415747146,1415747146,1415747146,1415747146,1415747148,1415747148,1415747148,1415747148,1415747148,1415747148,1415747148,1415747150,1415747150,1415747152,1415747152,1415747152,1415747152,1415747152,1415747152,1415747152,1415747153,1415747153,1415747153,1415747153,1415747154,1415747154,1415747154,1415747158,1415747160,1415747165,1415747165,1415747167,1415747171,1415747201,1415747202,1415747202,1415747203,1415747207,1415747207,1415747207,1415747210,1415747212,1415747214,1415747217,1415747224,1415747224,1415747224,1415747224,1415747225,1415747229,1415747229,1415747231,1415747240,1415747242,1415747253,1415747261,1415747263,1415747264,1415747267,1415747268,1415747272,1415747276,1415747278,1415747279,1415747279,1415747288,1415747289,1415747291,1415747291,1415747291,1415747291,1415747291,1415747291,1415747291,1415747291,1415747292,1415747302,1415747302,1415747305,1415747309,1415747312,1415747312,1415747314,1415747314,1415747314,1415747314,1415747314,1415747314,1415747316,1415747317,1415747318,1415747319,1415747320,1415747323,1415747324,1415747324,1415747326,1415747330,1415747330,1415747331,1415747333,1415747336,1415747336,1415747336,1415747336,1415747339,1415747340,1415747343,1415747345,1415747359,1415747359,1415747363,1415747365,1415747365,1415747365,1415747367,1415747374,1415747381,1415747381,1415747381],
//              "topBids":[{"amount":[1.2826,0.0939,0.2021,0.1,0.0373],
//                          "level":[0,0,0,0,0],
//                          "price":[2236.88,2236.24,2236.19,2236.17,2235.77],
//                          "accuAmount":[1.2826,1.3765,1.5786,1.6786,1.7159]}, ...
//                        ],
//              "tradeId":[25626053,25626054,25626055,25626056,25626057,25626058,25626059,25626060,25626061,25626062,25626063,25626064,25626065,25626066,25626067,25626068,25626069,25626070,25626071,25626072,25626073,25626074,25626075,25626076,25626077,25626078,25626079,25626080,25626081,25626082,25626083,25626084,25626085,25626086,25626087,25626088,25626089,25626090,25626091,25626092,25626093,25626094,25626095,25626096,25626097,25626098,25626099,25626100,25626101,25626102,25626103,25626104,25626105,25626106,25626107,25626108,25626109,25626110,25626111,25626112,25626113,25626114,25626115,25626116,25626117,25626118,25626119,25626120,25626121,25626122,25626123,25626124,25626125,25626126,25626127,25626128,25626129,25626130,25626131,25626132,25626133,25626134,25626135,25626136,25626137,25626138,25626139,25626140,25626141,25626142,25626143,25626144,25626145,25626146,25626147,25626148,25626149,25626150,25626151,25626152,25626153,25626154,25626155,25626156,25626157,25626158,25626159,25626160,25626161,25626162,25626163,25626164,25626165,25626166,25626167,25626168,25626169,25626170,25626171,25626172,25626173,25626174,25626175,25626176,25626177,25626178,25626179,25626180,25626181,25626182,25626183,25626184,25626185,25626186,25626187,25626188,25626189,25626190,25626191,25626192,25626193,25626194,25626195,25626196,25626197,25626198,25626199,25626200,25626201,25626202,25626203,25626204,25626205,25626206,25626207,25626208,25626209,25626210,25626211,25626212,25626213,25626214,25626215,25626216,25626217,25626218,25626219,25626220,25626221,25626222,25626223,25626224,25626225,25626226,25626227,25626228,25626229,25626230,25626231,25626232,25626233,25626234,25626235,25626236,25626237,25626238,25626239,25626240,25626241,25626242,25626243,25626244,25626245,25626246,25626247,25626248,25626249,25626250,25626251,25626252,25626253,25626254,25626255,25626256,25626257,25626258,25626259,25626260,25626261,25626262,25626263,25626264,25626265,25626266,25626267,25626268,25626269,25626270,25626271,25626272,25626273,25626274,25626275,25626276,25626277,25626278,25626279,25626280,25626281,25626282,25626283,25626284,25626285,25626286,25626287,25626288,25626289,25626290,25626291,25626292,25626293,25626294,25626295,25626296,25626297,25626298,25626299,25626300,25626301,25626302,25626303,25626304,25626305,25626306,25626307,25626308,25626309,25626310,25626311,25626312,25626313,25626314,25626315,25626316,25626317,25626318,25626319,25626320,25626321,25626322,25626323,25626324,25626325,25626326,25626327,25626328,25626329,25626330,25626331,25626332,25626333,25626334,25626335,25626336,25626337,25626338,25626339,25626340,25626341,25626342,25626343,25626344,25626345,25626346,25626347,25626348,25626349,25626350,25626351,25626352],
//              "direction":[1,1,1,2,2,2,2,2,2,1,1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,2,1,2,2,2,1,2,2,1,1,1,2,2,2,1,1,2,2,2,2,2,2,2,2,1,1,1,2,2,2,2,2,2,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,2,2,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,2,1,1,2,2,2,2,2,1,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,1,1,1,1,1,2,1,1,1,2,2,2,2,2,2,2,2,1,2,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,2,1,1,1,1,1,2,1,2,1,1,1,2,1,1,1,1,1,2,2,2,1,1,2,1,2,1,1,1,1,2,2,2,1,1,2,2,2]},
//              "requestIndex":1405131205518,"retCode":200,"version":1,"retMsg":""}]

//String str = "[{\"symbolId\":\"btccny\",\"version\":1,\"msgType\":\"reqMarketDetail\",\"requestIndex\":1405131205518}]";
// [{"msgType":"reqMarketDetail",
//   "payload":{"totalVolume":1.5054427253218725E8,
//              "symbolId":"btccny",
//              "amount":0,
//              "level":2233,
//              "amp":null,
//              "priceAverage":0,
//              "turnVolume":0,
//              "trades":{"amount":[0.05,0.05,0.01,0.005,0.002,0.001,0.135,0.0853,0.1,0.6524,0.39,0.0663,0.806,0.48,0.101,1.5866,0.697,0.0917,0.09,1.18,0.69,0.101,0.206,0.091,0.0557,0.0556,0.1516,0.0202,0.2808,0.0426,1.5866,0.6415,0.09,0.5335,0.8265,0.09,0.08,0.01,0.01,0.57,0.027,0.02,0.0416,0.147,0.0715,0.23,0.2,0.1,0.053,0.147,0.0285,0.1,0.57,0.1,0.01,0.0449,1.175,0.0423,0.1872,0.112],
//                        "price":[2233.24,2234.13,2233.26,2233.26,2233.26,2233.26,2233.6,2233.96,2233.84,2234,2234,2234,2234,2234,2234,2234,2234,2233.85,2233.85,2233.51,2233.51,2233.51,2233.52,2233.52,2233.53,2233.91,2234.18,2234.18,2234.18,2234.19,2234.23,2234.17,2234.16,2234.17,2234.16,2234.16,2234.21,2234.3,2234.35,2234.53,2234.16,2233.77,2233.8,2233.82,2234.92,2235.1,2235.1,2235.1,2235.02,2235.06,2234.92,2235.05,2235,2235,2235.55,2234.91,2234.98,2234.89,2234.87,2234.85],
//                        "time":[1415748050,1415748048,1415748037,1415748037,1415748037,1415748037,1415748029,1415748026,1415748026,1415748023,1415748023,1415748022,1415748022,1415748021,1415748021,1415748020,1415748019,1415748018,1415748016,1415748016,1415748015,1415748014,1415748014,1415748014,1415748014,1415748004,1415747998,1415747998,1415747998,1415747998,1415747998,1415747994,1415747994,1415747991,1415747991,1415747990,1415747986,1415747980,1415747977,1415747961,1415747946,1415747945,1415747945,1415747931,1415747905,1415747899,1415747898,1415747898,1415747896,1415747896,1415747895,1415747894,1415747894,1415747894,1415747892,1415747885,1415747885,1415747878,1415747878,1415747878],
//                        "direction":[2,1,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,2,2,1,1,1]},
//              "innerDisc":0,
//              "priceHigh":2242.14,
//              "volumeRatio":0,
//              "priceNew":2233.24,
//              "commissionRatio":0,
//              "totalAmount":67192.80190000037,
//              "priceLow":2216.13,
//              "updownVolume":0,
//              "poor":0,
//              "asks":{"amount":[0.3,0.1852,0.1183,0.24,0.018,0.13,0.048,0.15,0.2976,1.823],
//                      "level":[1,1,1,1,1,1,1,1,1,1],
//                      "price":[2234.18,2234.43,2234.47,2234.5,2234.62,2235.08,2235.12,2235.76,2238.13,2238.3],
//                      "accuAmount":[0.3,0.4852,0.6035,0.8435,0.8615,0.9915,1.0395,1.1895,1.4871,3.3101]},
//              "priceLast":2234.18,
//              "bids":{"amount":[0.0349,1.4522,1.196,5.1996,0.38,0.04,1.2851,0.1108,0.0025,0.15],
//                      "level":[1,1,1,1,1,1,1,1,0,0],
//                      "price":[2233.15,2233.09,2233.04,2233,2232.79,2232.74,2232.72,2232.49,2231.92,2231.82],
//                      "accuAmount":[0.0349,1.4871,2.6831,7.8827,8.2627,8.3027,9.5878,9.6986,9.7011,9.8511]},
//              "turnoverRate":0,
//              "outerDisc":0,
//              "priceOpen":2232,
//              "updownRatio":0},
//              "requestIndex":1405131205518,
//              "retCode":200,
//              "version":1,
//              "retMsg":""}]

//String str = "[{\"symbolId\":\"btccny\",\"version\":1,\"msgType\":\"reqMarketDetail\",\"requestIndex\":1405131205518}]";


// reqMsgSubscribe: Push message to subscribe
//String str = "[{\"version\":1,\"msgType\":\"reqMsgSubscribe\",\"requestIndex\":1405141205514," +
//              "\"symbolList\":{\"lastTimeLine\":[{\"symbolId\":\"btccny\",\"pushType\":\"pushLong\"}]}}]";
// [{"symbolId":"btccny",
//   "msgType":"lastTimeLine",
//   "payload":{"volume":262884.86402800004,
//              "symbolId":"btccny",
//              "amount":116.76299999999999,
//              "priceLast":2252.69,
//              "count":47,
//              "_id":1415752260,
//              "time":1415752260},
//   "version":1}]
// [{"symbolId":"btccny",
//   "msgType":"lastTimeLine",
//   "payload":{"volume":263110.138028,
//              "symbolId":"btccny",
//              "amount":116.86299999999999,
//              "priceLast":2252.74,
//              "count":48,
//              "_id":1415752260,
//              "time":1415752260},
//   "version":1}]
// [{"symbolId":"btccny",
//   "msgType":"lastTimeLine",
//   "payload":{"volume":375839.79217299994,
//              "symbolId":"btccny",
//              "amount":166.86299999999997,
//              "priceLast":2254.82,
//              "count":76,
//              "_id":1415752260,
//              "time":1415752260},
//   "version":1}]
// [{"symbolId":"btccny",
//   "msgType":"lastTimeLine",
//   "payload":{"volume":376245.5137729999,
//              "symbolId":"btccny",
//              "amount":167.04299999999998,
//              "priceLast":2254.82,
//              "count":78,
//              "_id":1415752260,
//              "time":1415752260},
//   "version":1}]

// reqMsgSubscribe: Push message to subscribe
//String str = "[{\"version\":1,\"msgType\":\"reqMsgSubscribe\",\"requestIndex\":1405141205514," +
//               "\"symbolList\":{\"marketDepthDiff\":[{\"symbolId\":\"btccny\",\"pushType\":\"pushLong\",\"percent\":\"10\"}]}}]";
// [{"symbolId":"btccny",
//   "msgType":"marketDepthDiff",
//   "payload":{"bidDelete":[149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0],
//              "symbolId":"btccny",
//              "bidInsert":{"amount":[0,0.06,0.3,0,3,4.001,81.4642,0,0,0.2,0,30.6031,1.1,0.0658,11.0863,6.4616,0.05,0.4048,6.2201,0.3031,0.2908,0,0,0,9.0385,1,0.2071,5,1.012,0,5.22,18.3868,11.0307,0.05,4.6416,1.48,2.6062,3.2,33.8027,0,0.05,0,82.7883,0,204.0144,1,377.1948,0.5993,0.6,0,4.7059,5.049,0,1018.1671,28.279,11.9975,0.25,11.271,17.8437,0.32,16.0661,1.347,0.01,0.15,0.1423,101.1408,32.4156,135.9283,3.2,0.21,0.68,81.0335,47.6092,0,206.7636,0.2,0.66,275.1756,21.7192,104.1,1.7488,0.925,17.7128,0.1305,11.4583,15.1264,13.0654,128.5941,167.6964,4.8136,234.8923,97.8179,3,0,8.9653,2.515,2,30.7671,33.2441,48.2045,62.8566,70.0272,188.4093,117.5276,123.9393,2.4802,15.014,23.1129,7.8156,114.3387,188.1806,142.2916,19.1414,17.5693,110.4339,20.4071,3,219.3169,24.3609,15.01,300.9607,82.5619,10.9184,53.8011,22.0616,82.6115,0.4038,24.0333,12.3936,5.409,88.2054,54.2857,26.5039,30.1523,0.09,15.6355,12,19.7899,0,0.018,38.822,48.0186,22.7231,68.8006,81.1276,33.4192,124.4158,9.1373,5.1345,2.29],
//                           "price":[2032.281,2033.7964966442953,2035.3119932885907,2036.827489932886,2038.3429865771811,2039.8584832214765,2041.3739798657718,2042.8894765100672,2044.4049731543626,2045.920469798658,2047.435966442953,2048.9514630872486,2050.4669597315437,2051.982456375839,2053.4979530201344,2055.0134496644296,2056.528946308725,2058.0444429530203,2059.5599395973154,2061.075436241611,2062.5909328859057,2064.1064295302012,2065.6219261744964,2067.137422818792,2068.652919463087,2070.168416107382,2071.683912751678,2073.199409395973,2074.7149060402685,2076.2304026845636,2077.745899328859,2079.2613959731543,2080.7768926174494,2082.292389261745,2083.80788590604,2085.3233825503357,2086.838879194631,2088.354375838926,2089.8698724832216,2091.3853691275167,2092.9008657718123,2094.4163624161074,2095.9318590604025,2097.447355704698,2098.9628523489932,2100.478348993289,2101.993845637584,2103.509342281879,2105.0248389261747,2106.54033557047,2108.0558322147654,2109.5713288590605,2111.086825503356,2112.602322147651,2114.1178187919463,2115.6333154362414,2117.1488120805366,2118.664308724832,2120.1798053691273,2121.695302013423,2123.210798657718,2124.726295302013,2126.2417919463087,2127.757288590604,2129.2727852348994,2130.7882818791945,2132.3037785234897,2133.8192751677852,2135.3347718120804,2136.850268456376,2138.365765100671,2139.881261744966,2141.396758389262,2142.912255033557,2144.4277516778525,2145.9432483221476,2147.458744966443,2148.9742416107383,2150.4897382550334,2152.005234899329,2153.520731543624,2155.0362281879197,2156.551724832215,2158.06722147651,2159.5827181208056,2161.0982147651007,2162.6137114093963,2164.1292080536914,2165.6447046979865,2167.160201342282,2168.6756979865772,2170.191194630873,2171.706691275168,2173.222187919463,2174.737684563758,2176.2531812080533,2177.768677852349,2179.284174496644,2180.7996711409396,2182.3151677852347,2183.83066442953,2185.3461610738254,2186.8616577181206,2188.377154362416,2189.8926510067113,2191.408147651007,2192.923644295302,2194.439140939597,2195.9546375838927,2197.470134228188,2198.9856308724834,2200.5011275167785,2202.0166241610737,2203.5321208053692,2205.0476174496644,2206.56311409396,2208.078610738255,2209.59410738255,2211.109604026846,2212.625100671141,2214.1405973154365,2215.6560939597316,2217.1715906040267,2218.6870872483223,2220.2025838926174,2221.718080536913,2223.233577181208,2224.7490738255037,2226.264570469799,2227.780067114094,2229.2955637583896,2230.8110604026842,2232.32655704698,2233.842053691275,2235.3575503355705,2236.8730469798656,2238.388543624161,2239.9040402684564,2241.4195369127515,2242.935033557047,2244.450530201342,2245.9660268456373,2247.481523489933,2248.997020134228,2250.5125167785236,2252.0280134228187,2253.543510067114,2255.0590067114094,2256.5745033557046,2258.09],
//                           "row":[149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0]},
//              "bidUpdate":{"amount":[],"price":[],"row":[]},
//              "versionOld":1415753726000,
//              "askInsert":{"amount":[0,6,0.053,121.397,1.01,0.2,0,1,0,0.01,1.5257,1,0,0,4.4689,0,0.0284,9.8785,0,0.05,0,0.05,0.83,38.6564,8.7021,111.4917,1.4644,15.4875,0.1,0,29.4035,0.3431,50.0159,0.5,0.15,0,10.0517,1,18.1011,0.1,26.372,3.4,4.9754,7.9783,7.75,0,11.472,0.05,0.1452,0,10.5038,0.1,0.3024,22.664,12.6969,0.21,140.1355,22.8762,5,42.3168,2.0607,0,0.5846,25.8398,30.3492,0.3261,16.423,0,0,16.3437,11,0.76,0.2121,46.0864,0,0.2,55.5778,33.1102,0.0137,0.0576,1.0176,0.4087,0.4875,22.5582,1.8341,5.3013,2.16,3.7033,15.8,171.7299,92.5161,26.7191,11.64,115.228,151.2591,125.02,239.0161,33.7351,136.857,6.694,2.6445,0,197.7049,1,40,10.0317,0.0455,0,21.6318,34.4181,17.106,0,14.1286,2,0.1724,0.2,27.2718,25.6053,4.4192,6,0,53.2422,168.7591,19.3973,0,4.5822,3,8.8,1.4982,60.2224,27.0432,6.2122,21.0165,77.2907,5.0049,659.8043,76.3965,9.9239,12.578,20.6108,2.5331,6.6779,73.6327,21.8534,55.6791,262.1347,105.0866,24.8054,14.3727,22.66],
//                           "price":[2486,2484.48322147651,2482.9664429530203,2481.44966442953,2479.93288590604,2478.4161073825503,2476.8993288590605,2475.38255033557,2473.8657718120803,2472.3489932885905,2470.8322147651006,2469.3154362416108,2467.798657718121,2466.281879194631,2464.765100671141,2463.2483221476514,2461.731543624161,2460.2147651006712,2458.6979865771814,2457.1812080536915,2455.6644295302012,2454.1476510067114,2452.6308724832215,2451.1140939597317,2449.5973154362414,2448.0805369127515,2446.5637583892617,2445.046979865772,2443.530201342282,2442.0134228187917,2440.496644295302,2438.979865771812,2437.463087248322,2435.946308724832,2434.429530201342,2432.912751677852,2431.3959731543623,2429.8791946308725,2428.3624161073826,2426.8456375838928,2425.328859060403,2423.812080536913,2422.2953020134228,2420.778523489933,2419.261744966443,2417.7449664429532,2416.2281879194634,2414.711409395973,2413.1946308724832,2411.6778523489934,2410.1610738255035,2408.6442953020132,2407.1275167785234,2405.6107382550335,2404.0939597315437,2402.5771812080534,2401.0604026845635,2399.5436241610737,2398.026845637584,2396.510067114094,2394.9932885906037,2393.476510067114,2391.959731543624,2390.442953020134,2388.9261744966443,2387.4093959731545,2385.8926174496646,2384.3758389261748,2382.8590604026845,2381.3422818791946,2379.8255033557048,2378.308724832215,2376.791946308725,2375.2751677852348,2373.758389261745,2372.241610738255,2370.7248322147652,2369.208053691275,2367.691275167785,2366.1744966442952,2364.6577181208054,2363.1409395973155,2361.6241610738252,2360.1073825503354,2358.5906040268455,2357.0738255033557,2355.557046979866,2354.040268456376,2352.523489932886,2351.0067114093963,2349.489932885906,2347.973154362416,2346.4563758389263,2344.9395973154365,2343.4228187919466,2341.9060402684563,2340.3892617449665,2338.8724832214766,2337.3557046979868,2335.8389261744965,2334.3221476510066,2332.8053691275168,2331.288590604027,2329.7718120805366,2328.2550335570468,2326.738255033557,2325.221476510067,2323.7046979865772,2322.187919463087,2320.671140939597,2319.1543624161072,2317.6375838926174,2316.1208053691275,2314.6040268456377,2313.087248322148,2311.570469798658,2310.053691275168,2308.536912751678,2307.020134228188,2305.503355704698,2303.9865771812083,2302.469798657718,2300.953020134228,2299.4362416107383,2297.9194630872485,2296.402684563758,2294.8859060402683,2293.3691275167785,2291.8523489932886,2290.3355704697988,2288.8187919463085,2287.3020134228186,2285.7852348993288,2284.268456375839,2282.7516778523486,2281.234899328859,2279.718120805369,2278.201342281879,2276.6845637583892,2275.1677852348994,2273.6510067114095,2272.1342281879197,2270.61744966443,2269.1006711409395,2267.5838926174497,2266.06711409396,2264.55033557047,2263.0335570469797,2261.51677852349,2260],
//                           "row":[149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0]},
//              "askUpdate":{"amount":[],"price":[],"row":[]},
//              "percent":"10",
//              "version":1415753727000,
//              "askDelete":[149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0]},
//   "version":1}]
// [{"symbolId":"btccny",
//   "msgType":"marketDepthDiff",
//   "payload":{"bidDelete":[],
//              "symbolId":"btccny",
//              "bidInsert":{"amount":[],"price":[],"row":[]},
//              "bidUpdate":{"amount":[9.6283,4.632,2.26],
//                           "price":[2255.0590067114094,2256.5745033557046,2258.09],
//                           "row":[2,1,0]},
//              "versionOld":1415753727000,
//              "askInsert":{"amount":[],"price":[],"row":[]},
//              "askUpdate":{"amount":[0.6779],
//                           "price":[2272.1342281879197],
//                           "row":[8]},
//              "percent":"10",
//              "version":1415753728000,
//              "askDelete":[]},
//   "version":1}]

// reqMsgSubscribe: Push message to subscribe
//                    String str = "[{\"version\":1,\"msgType\":\"reqMsgSubscribe\",\"requestIndex\":1405141205514," +
//                            "\"symbolList\":{\"marketDepthTopDiff\":[{\"symbolId\":\"btccny\",\"pushType\":\"pushLong\"}]}}]";
// [{"symbolId":"btccny",
//   "msgType":"marketDepthTopDiff",
//   "payload":{"bidDelete":[],
//              "symbolId":"btccny",
//              "bidInsert":{"amount":[],"price":[],"row":[]},
//              "bidUpdate":{"amount":[],"price":[],"row":[]},
//              "versionOld":1415828124090,
//              "askInsert":{"amount":[0.01],
//                           "price":[2868.46],
//                           "row":[149]},
//              "askUpdate":{"amount":[],"price":[],"row":[]},
//              "version":1415828124694,
//              "askDelete":[2]},
//   "version":1}]
// [{"symbolId":"btccny",
//   "msgType":"marketDepthTopDiff",
//   "payload":{"bidDelete":[2],
//              "symbolId":"btccny",
//              "bidInsert":{"amount":[99.05],"price":[2510],"row":[149]},
//              "bidUpdate":{"amount":[],"price":[],"row":[]},
//              "versionOld":1415828124694,
//              "askInsert":{"amount":[10],"price":[2682.92],"row":[42]},
//              "askUpdate":{"amount":[],"price":[],"row":[]},
//              "version":1415828124783,
//              "askDelete":[149]},
//    "version":1}]
// [{"symbolId":"btccny",
//   "msgType":"marketDepthTopDiff",
//   "payload":{"bidDelete":[12],
//              "symbolId":"btccny",
//              "bidInsert":{"amount":[6.7643],"price":[2509],"row":[149]},
//              "bidUpdate":{"amount":[],"price":[],"row":[]},
//              "versionOld":1415828124783,
//              "askInsert":{"amount":[10],"price":[2687.96],"row":[45]},
//              "askUpdate":{"amount":[],"price":[],"row":[]},
//              "version":1415828124968,
//              "askDelete":[149]},
//   "version":1}]
// [{"symbolId":"btccny",
//   "msgType":"marketDepthTopDiff",
//   "payload":{"bidDelete":[2],
//              "symbolId":"btccny",
//              "bidInsert":{"amount":[0.5],"price":[2637.63],"row":[12]},
//              "bidUpdate":{"amount":[3.5984], "price":[2647.19],"row":[0]},
//              "versionOld":1415828124968,
//              "askInsert":{"amount":[],"price":[],"row":[]},
//              "askUpdate":{"amount":[],"price":[],"row":[]},
//              "version":1415828125168,
//              "askDelete":[]},
//    "version":1}]

// reqMsgSubscribe: Push message to subscribe
//                    String str = "[{\"version\":1,\"msgType\":\"reqMsgSubscribe\",\"requestIndex\":1405141205515," +
//                            "\"symbolList\":{\"marketDetail\":[{\"symbolId\":\"btccny\",\"pushType\":\"pushLong\"}]}}]";
// [{"symbolId":"btccny",
//   "msgType":"marketDetail",
//   "idCur":1415829465,
//   "payload":{"totalVolume":4.9946938320821726E8,
//              "symbolId":"btccny",
//              "amount":0,
//              "level":2653,
//              "amp":null,
//              "priceAverage":0,
//              "turnVolume":0,
//              "trades":{"amount":[0.2029,0.0271,0.02,2.2834,0.849,2.0866,1.181,0.949,0.1825,0.265,2.0864,1.1111,0.0217,1.1111,0.9274,0.859,0.3,1.9222,0.1538,0.0165,0.011,0.06,0.08,0.1821,0.839,0.545,1.1976,0.13,0.02,0.09,0.13,0.04,0.13,0.16,0.07,0.11,0.06,0.21,0.42,0.27,0.4,0.14,0.25,0.23,0.31,0.02,0.2852,0.3,1.9222,0.02,0.0836,2.0864,0.0028,0.2897,0.2944,0.178,0.127,0.01,0.043,0.0305],
//                        "price":[2652.9,2653,2653,2653,2653.01,2653.04,2653.04,2653,2652.82,2652.79,2652.79,2652.79,2652.83,2651.1,2652.88,2652.88,2652.87,2652.86,2651,2651,2653,2653,2653.59,2653.6,2653.62,2653.62,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2653.58,2653.53,2653.49,2653.55,2656.97,2653.48,2653.49,2653.46,2653.45,2652.23,2652.19,2652.18,2652.19,2651,2650],
//                        "time":[1415829465,1415829465,1415829465,1415829465,1415829465,1415829465,1415829465,1415829461,1415829461,1415829458,1415829458,1415829458,1415829454,1415829452,1415829445,1415829445,1415829445,1415829445,1415829436,1415829436,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829433,1415829433,1415829433,1415829433,1415829433,1415829433,1415829432,1415829432,1415829432,1415829432,1415829432,1415829432,1415829432,1415829428,1415829420,1415829418,1415829418,1415829418,1415829417,1415829417,1415829415,1415829413,1415829402,1415829395,1415829395,1415829395,1415829393,1415829393],
//                        "direction":[2,2,2,2,2,2,2,1,1,2,1,1,1,2,1,1,1,1,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,1,1,2,1,1,1,2,1]},
//              "innerDisc":0,
//              "priceHigh":2750,
//              "volumeRatio":0,
//              "priceNew":2652.9,
//              "commissionRatio":0,
//              "totalAmount":205667.72510000027,
//              "priceLow":2460,
//              "updownVolume":0,
//              "poor":0,
//              "asks":{"amount":[0.978,3.2676,2,0.2807,0.386,0.92,2,0.0028,0.4314,13.0696],
//                      "level":[1,1,1,1,1,1,1,1,1,1],
//                      "price":[2655.95,2655.96,2656,2656.15,2656.95,2656.98,2657,2657.68,2658.95,2659],
//                      "accuAmount":[0.978,4.2456,6.2456,6.5263,6.9123,7.8323,9.8323,9.8351,10.2665,23.3361]},
//              "priceLast":2653.49,
//              "bids":{"amount":[1.9226,2.052,4,0.2129,3.5306,0.4218,1.1572,0.0028,0.006,5],
//                      "level":[1,1,1,1,1,1,1,1,1,1],
//                      "price":[2653.31,2653.26,2653.24,2653.11,2652.86,2652.8,2651,2649.89,2647.68,2647.2],
//                      "accuAmount":[1.9226,3.9746,7.9746,8.1875,11.7181,12.1399,13.2971,13.2999,13.3059,18.3059]},
//              "turnoverRate":0,
//              "outerDisc":0,
//              "priceOpen":2463.15,
//              "updownRatio":0},
//   "idPrev":0,
//   "_id":1415829465,
//   "version":1}]
// [{"symbolId":"btccny",
//   "msgType":"marketDetail",
//   "idCur":1415829465,
//   "payload":{"totalVolume":4.9946938320821726E8,
//              "symbolId":"btccny",
//              "amount":0,
//              "level":2653,
//              "amp":null,
//              "priceAverage":0,
//              "turnVolume":0,
//              "trades":{"amount":[0.2029,0.0271,0.02,2.2834,0.849,2.0866,1.181,0.949,0.1825,0.265,2.0864,1.1111,0.0217,1.1111,0.9274,0.859,0.3,1.9222,0.1538,0.0165,0.011,0.06,0.08,0.1821,0.839,0.545,1.1976,0.13,0.02,0.09,0.13,0.04,0.13,0.16,0.07,0.11,0.06,0.21,0.42,0.27,0.4,0.14,0.25,0.23,0.31,0.02,0.2852,0.3,1.9222,0.02,0.0836,2.0864,0.0028,0.2897,0.2944,0.178,0.127,0.01,0.043,0.0305],
//                        "price":[2652.9,2653,2653,2653,2653.01,2653.04,2653.04,2653,2652.82,2652.79,2652.79,2652.79,2652.83,2651.1,2652.88,2652.88,2652.87,2652.86,2651,2651,2653,2653,2653.59,2653.6,2653.62,2653.62,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2654,2653.58,2653.53,2653.49,2653.55,2656.97,2653.48,2653.49,2653.46,2653.45,2652.23,2652.19,2652.18,2652.19,2651,2650],
//                        "time":[1415829465,1415829465,1415829465,1415829465,1415829465,1415829465,1415829465,1415829461,1415829461,1415829458,1415829458,1415829458,1415829454,1415829452,1415829445,1415829445,1415829445,1415829445,1415829436,1415829436,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829435,1415829433,1415829433,1415829433,1415829433,1415829433,1415829433,1415829432,1415829432,1415829432,1415829432,1415829432,1415829432,1415829432,1415829428,1415829420,1415829418,1415829418,1415829418,1415829417,1415829417,1415829415,1415829413,1415829402,1415829395,1415829395,1415829395,1415829393,1415829393],
//                        "direction":[2,2,2,2,2,2,2,1,1,2,1,1,1,2,1,1,1,1,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,1,1,2,1,1,1,2,1]},
//              "innerDisc":0,
//              "priceHigh":2750,
//              "volumeRatio":0,
//              "priceNew":2652.9,
//              "commissionRatio":0,
//              "totalAmount":205667.72510000027,
//              "priceLow":2460,
//              "updownVolume":0,
//              "poor":0,
//              "asks":{"amount":[0.978,3.2676,2,0.2807,0.386,0.92,2,0.0028,0.4314,13.0696],
//                      "level":[1,1,1,1,1,1,1,1,1,1],
//                      "price":[2655.95,2655.96,2656,2656.15,2656.95,2656.98,2657,2657.68,2658.95,2659],
//                      "accuAmount":[0.978,4.2456,6.2456,6.5263,6.9123,7.8323,9.8323,9.8351,10.2665,23.3361]},
//              "priceLast":2653.49,
//              "bids":{"amount":[1.9226,2.052,4,0.2129,3.5306,0.4218,1.1572,0.0028,0.006,5],
//                      "level":[1,1,1,1,1,1,1,1,1,1],
//                      "price":[2653.31,2653.26,2653.24,2653.11,2652.86,2652.8,2651,2649.89,2647.68,2647.2],
//                      "accuAmount":[1.9226,3.9746,7.9746,8.1875,11.7181,12.1399,13.2971,13.2999,13.3059,18.3059]},
//              "turnoverRate":0,
//              "outerDisc":0,
//              "priceOpen":2463.15,
//              "updownRatio":0},
//   "idPrev":0,
//   "_id":1415829465,
//   "version":1}]

        // reqMsgSubscribe: Push message to subscribe
        String str = "[{\"version\":1,\"msgType\":\"reqMsgSubscribe\",\"requestIndex\":" + System.currentTimeMillis() + "," +
                "\"symbolList\":{\"tradeDetail\":[{\"symbolId\":\"btccny\",\"pushType\":\"pushLong\"}]}}]";
//{"symbolId":"btccny",
// "msgType":"tradeDetail",
// "idCur":33082292,
// "payload":{"symbolId":"btccny",
//            "amount":[0.267,0.233,0.05,0.01,0.02],
//            "price":[1855,1855,1854.92,1855,1855],
//            "topAsks":[{"amount":[4.837,0.1899,1.1628,4.9994,2.749],
//                        "level":[0,0,0,0,0],
//                        "price":[1855,1855.03,1855.98,1855.99,1856],
//                        "accuAmount":[4.837,5.0269,6.1897,11.1891,13.9381]},
//                       {"amount":[4.837,0.1899,1.1628,4.9994,2.749],
//                        "level":[0,0,0,0,0],
//                        "price":[1855,1855.03,1855.98,1855.99,1856],
//                        "accuAmount":[4.837,5.0269,6.1897,11.1891,13.9381]}],
//            "time":[1420291225,1420291225,1420291225,1420291225,1420291225],
//            "topBids":[{"amount":[1.239,0.1,0.51,1.081,0.02],
//                        "level":[0,0,0,0,0],
//                        "price":[1854.92,1854.6,1854.45,1854.31,1854.27],
//                        "accuAmount":[1.239,1.339,1.849,2.93,2.95]},
//                       {"amount":[1.239,0.1,0.51,1.081,0.02],
//                        "level":[0,0,0,0,0],
//                        "price":[1854.92,1854.6,1854.45,1854.31,1854.27],
//                        "accuAmount":[1.239,1.339,1.849,2.93,2.95]}],
//            "tradeId":[33082288,33082289,33082290,33082291,33082292],
//            "direction":[1,1,2,1,1]},
// "timeMax":1420291225,
// "idPrev":33082287,
// "_id":33082292,
// "timeMin":1420291225,
// "version":1}

        emit(str);
    }

    private void emit(String str) {
        System.out.println("str to emit: " + str);
        m_socket.emit("request", str);
    }

    private void subscribeIfNeeded() {
        if(m_socket == null) {
            subscribe();
        }
    }

    public static IWs create(Properties keys) {
        Huobi.init(keys);
        return new HuobiWs();
    }
    @Override public Exchange exchange() { return Exchange.HUOBI; }

    @Override public void subscribeTrades(Pair pair, ITradesListener listener) {
        if (pair != Pair.BTC_CNH) {
            throw new RuntimeException("pair " + pair + " not supported yet");
        }
        m_tradesListener = listener;
        subscribeIfNeeded();
    }

    @Override public void subscribeTop(Pair pair, ITopListener listener) {
        if (pair != Pair.BTC_CNH) {
            throw new RuntimeException("pair " + pair + " not supported yet");
        }
        m_topListener = listener;
        subscribeIfNeeded();
    }

    @Override public void stop() {
        // reqMsgSubscribe: Push message to subscribe
        String str = "[{\"version\":1,\"msgType\":\"reqMsgUnsubscribe\",\"requestIndex\":" + System.currentTimeMillis() + "," +
                "\"symbolList\":{\"tradeDetail\":[{\"symbolId\":\"btccny\",\"pushType\":\"pushLong\"}]}}]";
        emit(str);
        System.out.println("unsubscribe sent");
        try {
            Thread.sleep(500);
        } catch (InterruptedException e) {}
        m_socket.disconnect();
        System.out.println("Huobi: disconnected");
    }

    @Override public String getPropPrefix() {
        return "hu.";
    }
}
